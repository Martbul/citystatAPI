generator client {
  provider = "go run github.com/steebchen/prisma-client-go"
  output   = "./db"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id
  email             String    @unique
  firstName         String?
  lastName          String?
  userName          String?
  imageUrl          String    @default("https://48htuluf59.ufs.sh/f/1NvBfFppWcZeWF2WCCi3zDay6IgjQLVNYHEhKiCJ8OeGwTon")
  phoneNumber       String?
  cityStats         CityStat?
  role              Role      @default(USER)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  completedTutorial Boolean   @default(false)
  aboutMe           String?
  Settings          Settings?

  friends        Friend[]        @relation("FriendsFromUser")
  friendOf       Friend[]        @relation("FriendsToUser")
  note           String?         @default("")
  status         Status          @default(ACTIVE)
  visitedStreets VisitedStreet[]

  @@map("users")
}

model Friend {
  id        String  @id @default(cuid())
  userId    String  @map("user_id")
  friendId  String  @map("friend_id")
  firstName String?
  lastName  String?
  userName  String
  imageUrl  String?

  user   User @relation("FriendsFromUser", fields: [userId], references: [id])
  friend User @relation("FriendsToUser", fields: [friendId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, friendId])
  @@map("user_friends")
}

model CityStat {
  id                 String       @id @default(cuid())
  name               String
  state              String
  country            String
  population         Int?
  area               Float?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  userId             String       @unique
  user               User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  totalStreetsWalked Int          @default(0)
  totalKilometers    Float        @default(0)
  cityCoveragePct    Float        @default(0)
  daysActive         Int          @default(0)
  longestStreakDays  Int          @default(0)
  streetWalks        StreetWalk[]
  settingsId         String?

  @@map("city_stats")
}

model StreetWalk {
  id         String   @id @default(cuid())
  cityStat   CityStat @relation(fields: [cityStatId], references: [id], onDelete: Cascade)
  cityStatId String

  streetName String
  geoJson    Json
  distanceKm Float  @default(0)

  @@map("street_walks")
}

model VisitedStreet {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  sessionId       String   @map("session_id")
  streetId        String   @map("street_id")
  streetName      String   @map("street_name")
  entryTimestamp  BigInt   @map("entry_timestamp")
  exitTimestamp   BigInt?  @map("exit_timestamp")
  durationSeconds Int?     @map("duration_seconds")
  entryLatitude   Decimal  @map("entry_latitude") @db.Decimal(10, 8)
  entryLongitude  Decimal  @map("entry_longitude") @db.Decimal(11, 8)
  createdAt       DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([streetId])
  @@index([entryTimestamp])
  @@map("visited_streets")
}

model Settings {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  theme                   Theme    @default(Light)
  language                Language @default(En)
  enabledLocationTracking Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}

enum Language {
  En
  Es
  Fr
  De
  Zh
  Ja
  Ru
  Bg
}

enum Theme {
  Light
  Dark
  Auto
}

enum Status {
  ACTIVE
  SLEEP
  OFFLINE
  BANNED
  PENDING
  IDLE
  INVISIBLE
}

enum Role {
  USER
  ADMIN
  MODERATOR
}
